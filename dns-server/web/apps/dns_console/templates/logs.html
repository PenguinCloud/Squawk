[[extend 'layout.html']]

<div class="card">
    <div class="card-header">
        <h2 class="card-title">DNS Query Logs</h2>
    </div>
    
    [[if logs:]]
    <table>
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Token</th>
                <th>Domain Queried</th>
                <th>Query Type</th>
                <th>Status</th>
                <th>Client IP</th>
            </tr>
        </thead>
        <tbody>
            [[for log in logs:]]
            <tr>
                <td>[[=log.query_logs.timestamp.strftime('%Y-%m-%d %H:%M:%S') if log.query_logs.timestamp else 'N/A']]</td>
                <td>
                    [[if log.tokens and log.tokens.name:]]
                        [[=log.tokens.name]]
                    [[else:]]
                        <span class="badge badge-danger">Unknown/Invalid</span>
                    [[pass]]
                </td>
                <td><code>[[=log.query_logs.domain_queried]]</code></td>
                <td>[[=log.query_logs.query_type]]</td>
                <td>
                    [[if log.query_logs.status == 'allowed':]]
                        <span class="badge badge-success">Allowed</span>
                    [[elif log.query_logs.status == 'denied':]]
                        <span class="badge badge-danger">Denied</span>
                    [[else:]]
                        <span class="badge">[[=log.query_logs.status]]</span>
                    [[pass]]
                </td>
                <td>[[=log.query_logs.client_ip or 'N/A']]</td>
            </tr>
            [[pass]]
        </tbody>
    </table>
    
    <div style="margin-top: 2rem; display: flex; justify-content: center; gap: 1rem;">
        [[if page > 1:]]
        <a href="[[=URL('logs', vars=dict(page=page-1))]]" class="btn btn-secondary">Previous</a>
        [[pass]]
        
        <span style="padding: 0.5rem 1rem;">
            Page [[=page]] of [[=total_pages]] (Total: [[=total]] records)
        </span>
        
        [[if page < total_pages:]]
        <a href="[[=URL('logs', vars=dict(page=page+1))]]" class="btn btn-secondary">Next</a>
        [[pass]]
    </div>
    [[else:]]
    <p>No query logs available yet.</p>
    [[pass]]
</div>

<div class="card">
    <div class="card-header">
        <h2 class="card-title">Log Status Legend</h2>
    </div>
    
    <div style="display: flex; gap: 2rem;">
        <div>
            <span class="badge badge-success">Allowed</span>
            <span style="margin-left: 0.5rem;">Token had permission for the requested domain</span>
        </div>
        <div>
            <span class="badge badge-danger">Denied</span>
            <span style="margin-left: 0.5rem;">Token lacked permission for the requested domain</span>
        </div>
        <div>
            <span class="badge">Error</span>
            <span style="margin-left: 0.5rem;">Query resulted in an error</span>
        </div>
    </div>
</div>